<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mitra AI - Your Digital Farming Companion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
            min-height: 100vh;
            color: #333;
            transition: background 0.3s ease, color 0.3s ease;
        }
        body.dark-mode {
            background: linear-gradient(135deg, #1B5E20, #33691E);
            color: #EEE;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: background 0.3s ease;
        }
        body.dark-mode .container {
            background: #121212;
        }
        .header {
            background: linear-gradient(135deg, #2E7D32, #4CAF50);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            transition: background 0.3s ease;
        }
        body.dark-mode .header {
            background: linear-gradient(135deg, #1B5E20, #33691E);
        }
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            font-weight: 600;
        }
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        .language-selector {
            position: absolute;
            top: 15px;
            right: 15px;
        }
        .language-selector select {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }
        .dark-mode-toggle {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
        }
        .voice-section {
            padding: 30px 20px;
            text-align: center;
            background: linear-gradient(135deg, #E8F5E8, #F1F8E9);
            transition: background 0.3s ease;
        }
        body.dark-mode .voice-section {
            background: linear-gradient(135deg, #263238, #37474F);
        }
        .voice-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4CAF50, #66BB6A);
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
        }
        body.dark-mode .voice-button {
            background: linear-gradient(135deg, #388E3C, #66BB6A);
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
        }
        .voice-button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.4);
        }
        body.dark-mode .voice-button:hover {
            box-shadow: 0 10px 25px rgba(0,0,0,0.6);
        }
        .voice-button.listening {
            animation: pulse 1.5s infinite;
            background: linear-gradient(135deg, #FF5722, #FF7043);
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .voice-status {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
            transition: color 0.3s ease;
        }
        body.dark-mode .voice-status {
            color: #BBB;
        }
        .quick-actions {
            padding: 20px;
        }
        .quick-actions h3 {
            color: #2E7D32;
            margin-bottom: 15px;
            font-size: 18px;
            transition: color 0.3s ease;
        }
        body.dark-mode .quick-actions h3 {
            color: #81C784;
        }
        .action-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .action-card {
            background: white;
            border: 2px solid #E8F5E8;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        body.dark-mode .action-card {
            background: #1E1E1E;
            border-color: #333;
            box-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }
        .action-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.2);
            border-color: #4CAF50;
        }
        body.dark-mode .action-card:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.6);
            border-color: #81C784;
        }
        .action-card .icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }
        .action-card h4 {
            color: #2E7D32;
            font-size: 14px;
            margin-bottom: 5px;
            transition: color 0.3s ease;
        }
        body.dark-mode .action-card h4 {
            color: #81C784;
        }
        .action-card p {
            color: #666;
            font-size: 12px;
            line-height: 1.3;
            transition: color 0.3s ease;
        }
        body.dark-mode .action-card p {
            color: #BBB;
        }
        .chat-section {
            padding: 20px;
            background: #f9f9f9;
            display: none;
            transition: background 0.3s ease;
        }
        body.dark-mode .chat-section {
            background: #1E1E1E;
        }
        .chat-messages {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        .message {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: background 0.3s ease;
        }
        body.dark-mode .message {
            background: #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        .message.ai {
            background: linear-gradient(135deg, #E8F5E8, #F1F8E9);
            border-left: 4px solid #4CAF50;
            transition: background 0.3s ease, border-color 0.3s ease;
        }
        body.dark-mode .message.ai {
            background: linear-gradient(135deg, #263238, #37474F);
            border-left-color: #81C784;
        }
        .message.user {
            background: #2196F3;
            color: white;
            margin-left: 20px;
        }
        body.dark-mode .message.user {
            background: #1976D2;
        }
        .image-upload {
            padding: 20px;
            background: #f5f5f5;
            text-align: center;
            display: none;
            transition: background 0.3s ease;
        }
        body.dark-mode .image-upload {
            background: #1E1E1E;
        }
        .upload-area {
            border: 2px dashed #4CAF50;
            border-radius: 12px;
            padding: 40px 20px;
            cursor: pointer;
            transition: all 0.3s ease, border-color 0.3s ease;
        }
        body.dark-mode .upload-area {
            border-color: #81C784;
        }
        .upload-area:hover {
            background: #E8F5E8;
        }
        body.dark-mode .upload-area:hover {
            background: #263238;
        }
        .upload-area input {
            display: none;
        }
        .weather-widget, .price-widget {
            background: white;
            margin: 20px;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }
        body.dark-mode .weather-widget, body.dark-mode .price-widget {
            background: #1E1E1E;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        .weather-widget h3, .price-widget h3 {
            color: #2E7D32;
            margin-bottom: 10px;
            font-size: 16px;
            transition: color 0.3s ease;
        }
        body.dark-mode .weather-widget h3, body.dark-mode .price-widget h3 {
            color: #81C784;
        }
        .weather-info, .price-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .temp {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
            transition: color 0.3s ease;
        }
        body.dark-mode .temp {
            color: #81C784;
        }
        .price {
            font-size: 18px;
            font-weight: bold;
            color: #FF9800;
            transition: color 0.3s ease;
        }
        body.dark-mode .price {
            color: #FFB74D;
        }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 400px;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }
        body.dark-mode .bottom-nav {
            background: #121212;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
        }
        .nav-item {
            text-align: center;
            cursor: pointer;
            padding: 5px;
            border-radius: 8px;
            transition: all 0.3s ease;
            flex: 1;
        }
        .nav-item:hover {
            background: #E8F5E8;
        }
        body.dark-mode .nav-item:hover {
            background: #263238;
        }
        .nav-item.active {
            background: #4CAF50;
            color: white;
        }
        body.dark-mode .nav-item.active {
            background: #388E3C;
        }
        .nav-item .icon {
            font-size: 20px;
            margin-bottom: 2px;
        }
        .nav-item .label {
            font-size: 10px;
        }
        .hidden {
            display: none;
        }
        .visible {
            display: block;
        }
        @media (max-width: 400px) {
            .container {
                max-width: 100%;
            }
            .bottom-nav {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="dark-mode-toggle" id="darkModeToggle">üåô Dark Mode</button>
            <div class="language-selector">
                <select id="languageSelect">
                    <option value="en">English</option>
                    <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
                    <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
                    <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
                    <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
                </select>
            </div>
            <h1>üåæ Mitra AI</h1>
            <p id="headerSubtitle">Your Digital Farming Companion</p>
        </div>
        <!-- Main Dashboard -->
        <div id="dashboard" class="section">
            <div class="voice-section">
                <button class="voice-button" id="voiceButton">
                    üé§<br>Tap to Speak
                </button>
                <div class="voice-status" id="voiceStatus">Say "Hi Mitra" to get started</div>
            </div>
            <div class="quick-actions">
                <h3 id="quickActionsTitle">Quick Actions</h3>
                <div class="action-grid">
                    <div class="action-card" onclick="showSection('chat', event)">
                        <span class="icon">üå±</span>
                        <h4 id="cropAdviceTitle">Crop Advice</h4>
                        <p id="cropAdviceDesc">Get personalized crop recommendations</p>
                    </div>
                    <div class="action-card" onclick="showSection('disease', event)">
                        <span class="icon">üîç</span>
                        <h4 id="diseaseDetectionTitle">Disease Detection</h4>
                        <p id="diseaseDetectionDesc">Upload plant photos for diagnosis</p>
                    </div>
                    <div class="action-card" onclick="showSection('weather', event)">
                        <span class="icon">üå§Ô∏è</span>
                        <h4 id="weatherTitle">Weather</h4>
                        <p id="weatherDesc">Local weather forecasts & alerts</p>
                    </div>
                    <div class="action-card" onclick="showSection('market', event)">
                        <span class="icon">üí∞</span>
                        <h4 id="marketTitle">Market Prices</h4>
                        <p id="marketDesc">Real-time mandi prices</p>
                    </div>
                </div>
            </div>
            <div class="weather-widget">
                <h3 id="currentWeatherTitle">Today's Weather</h3>
                <div class="weather-info">
                    <div>
                        <div class="temp">28¬∞C</div>
                        <div>Partly Cloudy</div>
                    </div>
                    <div>
                        <div>üíß 65% Humidity</div>
                        <div>üí® 12 km/h Wind</div>
                    </div>
                </div>
            </div>
            <div class="price-widget">
                <h3 id="marketPricesTitle">Market Prices</h3>
                <div class="price-info">
                    <div>
                        <div>üçÖ Tomato</div>
                        <div>üåæ Wheat</div>
                    </div>
                    <div>
                        <div class="price">‚Çπ25/kg</div>
                        <div class="price">‚Çπ2100/qtl</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Disease Detection Section -->
        <div id="disease" class="section hidden">
            <div class="image-upload">
                <h3 id="diseaseUploadTitle">Plant Disease Detection</h3>
                <div class="upload-area" onclick="document.getElementById('imageInput').click()">
                    <input type="file" id="imageInput" accept="image/*" onchange="handleImageUpload(event)">
                    <div>üì∑</div>
                    <p id="uploadInstruction">Tap to upload plant photo</p>
                </div>
            </div>
            <div class="chat-section" id="diseaseResults" style="display:none;">
                <div class="chat-messages" id="diseaseMessages"></div>
            </div>
        </div>
        <!-- Chat Section -->
        <div id="chat" class="section hidden">
            <div class="chat-section" style="display:block;">
                <h3 id="chatTitle">Chat with Mitra</h3>
                <div class="chat-messages" id="chatMessages"></div>
                <button class="voice-button" style="width:60px; height:60px; font-size:14px;" onclick="startVoiceChat()">
                    üé§
                </button>
            </div>
        </div>
        <!-- Weather Section -->
        <div id="weather" class="section hidden">
            <div style="padding: 20px;">
                <h3 id="weatherForecastTitle">7-Day Weather Forecast</h3>
                <div id="weatherForecast"></div>
            </div>
        </div>
        <!-- Market Section -->
        <div id="market" class="section hidden">
            <div style="padding: 20px;">
                <h3 id="marketDetailsTitle">Market Information</h3>
                <div id="marketDetails"></div>
            </div>
        </div>
        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="showSection('dashboard', event)">
                <div class="icon">üè†</div>
                <div class="label" id="homeLabel">Home</div>
            </div>
            <div class="nav-item" onclick="showSection('chat', event)">
                <div class="icon">üí¨</div>
                <div class="label" id="chatLabel">Chat</div>
            </div>
            <div class="nav-item" onclick="showSection('weather', event)">
                <div class="icon">üå§Ô∏è</div>
                <div class="label" id="weatherLabel">Weather</div>
            </div>
            <div class="nav-item" onclick="showSection('market', event)">
                <div class="icon">üí∞</div>
                <div class="label" id="marketLabel">Market</div>
            </div>
        </div>
    </div>
    <script>
        let currentLanguage = 'en';
        let isListening = false;
        let recognition;
        let userLocation = null;
        let weatherData = null;
        let isDarkMode = false;
        // Language translations
        const translations = {
            en: {
                headerSubtitle: "Your Digital Farming Companion",
                quickActionsTitle: "Quick Actions",
                cropAdviceTitle: "Crop Advice",
                cropAdviceDesc: "Get personalized crop recommendations",
                diseaseDetectionTitle: "Disease Detection",
                diseaseDetectionDesc: "Upload plant photos for diagnosis",
                weatherTitle: "Weather",
                weatherDesc: "Local weather forecasts & alerts",
                marketTitle: "Market Prices",
                marketDesc: "Real-time mandi prices",
                currentWeatherTitle: "Today's Weather",
                marketPricesTitle: "Market Prices",
                diseaseUploadTitle: "Plant Disease Detection",
                uploadInstruction: "Tap to upload plant photo",
                chatTitle: "Chat with Mitra",
                weatherForecastTitle: "7-Day Weather Forecast",
                marketDetailsTitle: "Market Information",
                homeLabel: "Home",
                chatLabel: "Chat",
                weatherLabel: "Weather",
                marketLabel: "Market"
            },
            hi: {
                headerSubtitle: "‡§Ü‡§™‡§ï‡§æ ‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§ñ‡•á‡§§‡•Ä ‡§∏‡§æ‡§•‡•Ä",
                quickActionsTitle: "‡§§‡•ç‡§µ‡§∞‡§ø‡§§ ‡§ï‡§æ‡§∞‡•ç‡§Ø",
                cropAdviceTitle: "‡§´‡§∏‡§≤ ‡§∏‡§≤‡§æ‡§π",
                cropAdviceDesc: "‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§´‡§∏‡§≤ ‡§∏‡•Å‡§ù‡§æ‡§µ ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç",
                diseaseDetectionTitle: "‡§∞‡•ã‡§ó ‡§™‡§π‡§ö‡§æ‡§®",
                diseaseDetectionDesc: "‡§®‡§ø‡§¶‡§æ‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•å‡§ß‡•ã‡§Ç ‡§ï‡•Ä ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞‡•á‡§Ç ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç",
                weatherTitle: "‡§Æ‡•å‡§∏‡§Æ",
                weatherDesc: "‡§∏‡•ç‡§•‡§æ‡§®‡•Ä‡§Ø ‡§Æ‡•å‡§∏‡§Æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§® ‡§î‡§∞ ‡§Ö‡§≤‡§∞‡•ç‡§ü",
                marketTitle: "‡§¨‡§æ‡§ú‡§º‡§æ‡§∞ ‡§≠‡§æ‡§µ",
                marketDesc: "‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§∏‡§Æ‡§Ø ‡§Æ‡§Ç‡§°‡•Ä ‡§Æ‡•Ç‡§≤‡•ç‡§Ø",
                currentWeatherTitle: "‡§Ü‡§ú ‡§ï‡§æ ‡§Æ‡•å‡§∏‡§Æ",
                marketPricesTitle: "‡§¨‡§æ‡§ú‡§º‡§æ‡§∞ ‡§≠‡§æ‡§µ",
                diseaseUploadTitle: "‡§™‡•å‡§ß‡•á ‡§ï‡•Ä ‡§¨‡•Ä‡§Æ‡§æ‡§∞‡•Ä ‡§ï‡•Ä ‡§™‡§π‡§ö‡§æ‡§®",
                uploadInstruction: "‡§™‡•å‡§ß‡•á ‡§ï‡•Ä ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ü‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç",
                chatTitle: "‡§Æ‡§ø‡§§‡•ç‡§∞‡§æ ‡§∏‡•á ‡§¨‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç",
                weatherForecastTitle: "7-‡§¶‡§ø‡§® ‡§Æ‡•å‡§∏‡§Æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§®‡•Å‡§Æ‡§æ‡§®",
                marketDetailsTitle: "‡§¨‡§æ‡§ú‡§º‡§æ‡§∞ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä",
                homeLabel: "‡§π‡•ã‡§Æ",
                chatLabel: "‡§ö‡•à‡§ü",
                weatherLabel: "‡§Æ‡•å‡§∏‡§Æ",
                marketLabel: "‡§Æ‡§æ‡§∞‡•ç‡§ï‡•á‡§ü"
            },
            te: {
                headerSubtitle: "‡∞Æ‡±Ä ‡∞°‡∞ø‡∞ú‡∞ø‡∞ü‡∞≤‡±ç ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø ‡∞∏‡∞π‡∞æ‡∞Ø‡∞ï‡±Å‡∞°‡±Å",
                quickActionsTitle: "‡∞§‡±ç‡∞µ‡∞∞‡∞ø‡∞§ ‡∞ö‡∞∞‡±ç‡∞Ø‡∞≤‡±Å",
                cropAdviceTitle: "‡∞™‡∞Ç‡∞ü ‡∞∏‡∞≤‡∞π‡∞æ",
                cropAdviceDesc: "‡∞µ‡±ç‡∞Ø‡∞ï‡±ç‡∞§‡∞ø‡∞ó‡∞§‡±Ä‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø‡∞® ‡∞™‡∞Ç‡∞ü ‡∞∏‡∞ø‡∞´‡∞æ‡∞∞‡±ç‡∞∏‡±Å‡∞≤‡±Å ‡∞™‡±ä‡∞Ç‡∞¶‡∞Ç‡∞°‡∞ø",
                diseaseDetectionTitle: "‡∞µ‡±ç‡∞Ø‡∞æ‡∞ß‡∞ø ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞Ç‡∞™‡±Å",
                diseaseDetectionDesc: "‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞£ ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞Æ‡±ä‡∞ï‡±ç‡∞ï‡∞≤ ‡∞´‡±ã‡∞ü‡±ã‡∞≤‡∞®‡±Å ‡∞Ö‡∞™‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
                weatherTitle: "‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£‡∞Ç",
                weatherDesc: "‡∞∏‡±ç‡∞•‡∞æ‡∞®‡±Ä‡∞Ø ‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£ ‡∞Ö‡∞Ç‡∞ö‡∞®‡∞æ‡∞≤‡±Å & ‡∞π‡±Ü‡∞ö‡±ç‡∞ö‡∞∞‡∞ø‡∞ï‡∞≤‡±Å",
                marketTitle: "‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç ‡∞ß‡∞∞‡∞≤‡±Å",
                marketDesc: "‡∞∞‡∞ø‡∞Ø‡∞≤‡±ç ‡∞ü‡±à‡∞Æ‡±ç ‡∞Æ‡∞Ç‡∞°‡∞ø ‡∞ß‡∞∞‡∞≤‡±Å",
                currentWeatherTitle: "‡∞®‡±á‡∞ü‡∞ø ‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£‡∞Ç",
                marketPricesTitle: "‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç ‡∞ß‡∞∞‡∞≤‡±Å",
                diseaseUploadTitle: "‡∞Æ‡±ä‡∞ï‡±ç‡∞ï‡∞≤ ‡∞µ‡±ç‡∞Ø‡∞æ‡∞ß‡∞ø ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞Ç‡∞™‡±Å",
                uploadInstruction: "‡∞Æ‡±ä‡∞ï‡±ç‡∞ï‡∞≤ ‡∞´‡±ã‡∞ü‡±ã ‡∞Ö‡∞™‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞ü‡±ç‡∞Ø‡∞æ‡∞™‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
                chatTitle: "‡∞Æ‡∞ø‡∞§‡±ç‡∞∞‡∞æ‡∞§‡±ã ‡∞ö‡∞æ‡∞ü‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø",
                weatherForecastTitle: "7-‡∞∞‡±ã‡∞ú‡±Å‡∞≤ ‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£ ‡∞Ö‡∞Ç‡∞ö‡∞®‡∞æ",
                marketDetailsTitle: "‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç ‡∞∏‡∞Æ‡∞æ‡∞ö‡∞æ‡∞∞‡∞Ç",
                homeLabel: "‡∞π‡±ã‡∞Æ‡±ç",
                chatLabel: "‡∞ö‡∞æ‡∞ü‡±ç",
                weatherLabel: "‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£‡∞Ç",
                marketLabel: "‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç"
            }
        };
        // Initialize app
        function initApp() {
            updateLanguage();
            initSpeechRecognition();
            getUserLocation();
            loadWeatherForecast();
            loadMarketDetails();
            toggleDarkMode(); // Initialize dark mode state
        }
        // Toggle dark mode
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            const toggleButton = document.getElementById('darkModeToggle');
            toggleButton.textContent = isDarkMode ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
        }
        // Get user's current location
        function getUserLocation() {
            if ("geolocation" in navigator) {
                document.getElementById('voiceStatus').textContent = 'Getting your location...';
               
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        document.getElementById('voiceStatus').textContent = 'Location found! Loading weather data...';
                        loadLiveWeatherData();
                        loadLiveMarketData();
                    },
                    function(error) {
                        console.log('Location error:', error);
                        document.getElementById('voiceStatus').textContent = 'Using default location data';
                        // Fallback to default location (Hyderabad)
                        userLocation = { lat: 17.3850, lng: 78.4867 };
                        loadLiveWeatherData();
                        loadLiveMarketData();
                    },
                    {
                        timeout: 10000,
                        maximumAge: 300000 // 5 minutes
                    }
                );
            } else {
                // Fallback to default location
                userLocation = { lat: 17.3850, lng: 78.4867 };
                loadLiveWeatherData();
                loadLiveMarketData();
            }
        }
        // Load live weather data
        async function loadLiveWeatherData() {
            try {
                // Using OpenWeatherMap API (you'll need to replace with actual API key)
                const apiKey = 'YOUR_OPENWEATHERMAP_API_KEY'; // Replace with your actual API key for real data
                const weatherUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${userLocation.lat}&lon=${userLocation.lng}&appid=${apiKey}&units=metric`;
               
                // For demo purposes, we'll simulate if API key is not set, but in production fetch real data
                // const response = await fetch(weatherUrl);
                // const data = await response.json();
                // weatherData = data;
                
                // Mock data as placeholder
                const mockWeatherData = {
                    main: {
                        temp: Math.round(25 + Math.random() * 10),
                        humidity: Math.round(50 + Math.random() * 30),
                        feels_like: Math.round(25 + Math.random() * 10)
                    },
                    weather: [
                        {
                            main: ['Clear', 'Clouds', 'Rain', 'Drizzle'][Math.floor(Math.random() * 4)],
                            description: 'Partly cloudy'
                        }
                    ],
                    wind: {
                        speed: Math.round(5 + Math.random() * 10)
                    },
                    name: await getCityName(userLocation.lat, userLocation.lng)
                };
                weatherData = mockWeatherData;
                updateCurrentWeather();
                document.getElementById('voiceStatus').textContent = `Weather updated for ${weatherData.name}`;
               
                // Update status after 2 seconds
                setTimeout(() => {
                    document.getElementById('voiceStatus').textContent = 'Say "Hi Mitra" to get started';
                }, 2000);
            } catch (error) {
                console.error('Weather API error:', error);
                document.getElementById('voiceStatus').textContent = 'Weather data unavailable';
            }
        }
        // Get city name from coordinates
        async function getCityName(lat, lng) {
            // In a real app, you'd use reverse geocoding API
            // For now, we'll return a simulated city name
            const cities = ['Hyderabad', 'Mumbai', 'Delhi', 'Bangalore', 'Chennai', 'Pune', 'Kolkata'];
            return cities[Math.floor(Math.random() * cities.length)];
        }
        // Update current weather display
        function updateCurrentWeather() {
            if (!weatherData) return;
            const weatherWidget = document.querySelector('.weather-widget .weather-info');
            const tempElement = weatherWidget.querySelector('.temp');
            const conditionElements = weatherWidget.querySelectorAll('div:not(.temp)');
            tempElement.textContent = `${weatherData.main.temp}¬∞C`;
           
            // Update weather details
            const weatherDetails = weatherWidget.children[1];
            weatherDetails.innerHTML = `
                <div>üíß ${weatherData.main.humidity}% Humidity</div>
                <div>üí® ${weatherData.wind.speed} km/h Wind</div>
            `;
            // Update weather condition
            const conditionText = weatherWidget.children[0].children[1];
            conditionText.textContent = weatherData.weather[0].description;
        }
        // Load live market data based on location
        async function loadLiveMarketData() {
            try {
                // Simulate location-based market data
                // In real app, integrate a market API like Agmarknet or similar
                // Example: const response = await fetch('https://api.agmarknet.gov.in/...');
                const locationBasedPrices = generateLocationBasedPrices();
                updateCurrentPrices(locationBasedPrices);
            } catch (error) {
                console.error('Market API error:', error);
            }
        }
        // Generate location-based market prices
        function generateLocationBasedPrices() {
            const basePrice = {
                tomato: 25,
                wheat: 2100,
                onion: 18,
                rice: 3200
            };
            // Simulate regional price variations
            const locationFactor = 0.8 + Math.random() * 0.4; // 0.8 to 1.2 multiplier
           
            return {
                tomato: Math.round(basePrice.tomato * locationFactor),
                wheat: Math.round(basePrice.wheat * locationFactor),
                onion: Math.round(basePrice.onion * locationFactor),
                rice: Math.round(basePrice.rice * locationFactor)
            };
        }
        // Update current prices display
        function updateCurrentPrices(prices) {
            const priceWidget = document.querySelector('.price-widget .price-info');
            const priceElements = priceWidget.querySelectorAll('.price');
           
            if (priceElements.length >= 2) {
                priceElements[0].textContent = `‚Çπ${prices.tomato}/kg`;
                priceElements[1].textContent = `‚Çπ${prices.wheat}/qtl`;
            }
        }
        // Update language
        function updateLanguage() {
            const lang = document.getElementById('languageSelect').value;
            currentLanguage = lang;
           
            if (translations[lang]) {
                Object.keys(translations[lang]).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.textContent = translations[lang][key];
                    }
                });
            }
        }
        // Initialize speech recognition
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = false;
                recognition.lang = getLanguageCode(currentLanguage);
                recognition.interimResults = false;
                recognition.maxAlternatives = 1;
                recognition.onstart = function() {
                    isListening = true;
                    document.getElementById('voiceButton').classList.add('listening');
                    document.getElementById('voiceStatus').textContent = 'Listening...';
                };
                recognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    handleVoiceInput(transcript);
                };
                recognition.onerror = function(event) {
                    console.log('Speech recognition error:', event.error);
                    stopListening();
                };
                recognition.onend = function() {
                    stopListening();
                };
            }
        }
        function getLanguageCode(lang) {
            const codes = {
                'en': 'en-US',
                'hi': 'hi-IN',
                'te': 'te-IN',
                'mr': 'mr-IN',
                'ta': 'ta-IN'
            };
            return codes[lang] || 'en-US';
        }
        function startListening() {
            if (recognition && !isListening) {
                recognition.lang = getLanguageCode(currentLanguage);
                recognition.start();
            }
        }
        function stopListening() {
            isListening = false;
            document.getElementById('voiceButton').classList.remove('listening');
            document.getElementById('voiceStatus').textContent = 'Say "Hi Mitra" to get started';
        }
        function handleVoiceInput(text) {
            addChatMessage(text, 'user');
           
            // Simulate AI response
            setTimeout(() => {
                let response = generateAIResponse(text);
                addChatMessage(response, 'ai');
                speakText(response);
            }, 1000);
        }
        function generateAIResponse(input) {
            const responses = {
                en: {
                    greeting: "Hello! I'm Mitra, your farming assistant. How can I help you today?",
                    creator: "I was made by team codestrom from AI&ML for supporting the farmers to upgrade.",
                    crop: `Based on your location's soil and weather conditions (${weatherData ? weatherData.name : 'your area'}), I recommend planting tomatoes this season. Current temperature ${weatherData ? weatherData.main.temp + '¬∞C' : '28¬∞C'} is ideal for growth.`,
                    disease: "Please upload a photo of your plant, and I'll help identify any diseases and suggest treatments.",
                    weather: `Current weather in ${weatherData ? weatherData.name : 'your area'}: ${weatherData ? weatherData.main.temp + '¬∞C, ' + weatherData.weather[0].description : '28¬∞C, partly cloudy'}. ${weatherData && weatherData.main.humidity > 80 ? 'High humidity - watch for fungal diseases.' : 'Good conditions for most farm activities.'}`,
                    market: `Current market prices in your region: Tomato ‚Çπ${generateLocationBasedPrices().tomato}/kg, Wheat ‚Çπ${generateLocationBasedPrices().wheat}/qtl. Prices vary by ¬±15% based on your location.`,
                    default: "I understand you're asking about farming. Could you be more specific? I can help with crops, diseases, weather, or market prices based on your location."
                },
                hi: {
                    greeting: "‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§Æ‡§ø‡§§‡•ç‡§∞‡§æ ‡§π‡•Ç‡§Å, ‡§Ü‡§™‡§ï‡§æ ‡§ñ‡•á‡§§‡•Ä ‡§∏‡§π‡§æ‡§Ø‡§ï‡•§ ‡§Ü‡§ú ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡•à‡§∏‡•á ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å?",
                    creator: "‡§Æ‡•à‡§Ç AI&ML ‡§∏‡•á ‡§ü‡•Ä‡§Æ ‡§ï‡•ã‡§°‡•á‡§∏‡•ç‡§ü‡•ç‡§∞‡•â‡§Æ ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§Ö‡§™‡§ó‡•ç‡§∞‡•á‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Æ‡§∞‡•ç‡§•‡§® ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§®‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§•‡§æ‡•§",
                    crop: `‡§Ü‡§™‡§ï‡•á ‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡•Ä ‡§Æ‡§ø‡§ü‡•ç‡§ü‡•Ä ‡§î‡§∞ ‡§Æ‡•å‡§∏‡§Æ ‡§ï‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ (${weatherData ? weatherData.name : '‡§Ü‡§™‡§ï‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞'}), ‡§Æ‡•à‡§Ç ‡§á‡§∏ ‡§∏‡•Ä‡§ú‡§® ‡§Æ‡•á‡§Ç ‡§ü‡§Æ‡§æ‡§ü‡§∞ ‡§≤‡§ó‡§æ‡§®‡•á ‡§ï‡•Ä ‡§∏‡§≤‡§æ‡§π ‡§¶‡•á‡§§‡§æ ‡§π‡•Ç‡§Å‡•§`,
                    disease: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ö‡§™‡§®‡•á ‡§™‡•å‡§ß‡•á ‡§ï‡•Ä ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç, ‡§î‡§∞ ‡§Æ‡•à‡§Ç ‡§¨‡•Ä‡§Æ‡§æ‡§∞‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•Ä ‡§™‡§π‡§ö‡§æ‡§® ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡•Ç‡§Ç‡§ó‡§æ‡•§",
                    weather: `${weatherData ? weatherData.name : '‡§Ü‡§™‡§ï‡•á ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞'} ‡§Æ‡•á‡§Ç ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•å‡§∏‡§Æ: ${weatherData ? weatherData.main.temp + '¬∞C, ' + weatherData.weather[0].description : '28¬∞C, ‡§Ü‡§Ç‡§∂‡§ø‡§ï ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§¨‡§æ‡§¶‡§≤'}‡•§`,
                    market: `‡§Ü‡§™‡§ï‡•á ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞ ‡§Æ‡•á‡§Ç ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§¨‡§æ‡§ú‡§º‡§æ‡§∞ ‡§≠‡§æ‡§µ: ‡§ü‡§Æ‡§æ‡§ü‡§∞ ‚Çπ${generateLocationBasedPrices().tomato}/‡§ï‡§ø‡§≤‡•ã‡•§`,
                    default: "‡§Æ‡•à‡§Ç ‡§∏‡§Æ‡§ù‡§§‡§æ ‡§π‡•Ç‡§Å ‡§ï‡§ø ‡§Ü‡§™ ‡§ñ‡•á‡§§‡•Ä ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§™‡•Ç‡§õ ‡§∞‡§π‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™‡§ï‡•á ‡§∏‡•ç‡§•‡§æ‡§® ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§Æ‡•à‡§Ç ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å‡•§"
                },
                te: {
                    greeting: "‡∞®‡∞Æ‡∞∏‡±ç‡∞ï‡∞æ‡∞∞‡∞Ç! ‡∞®‡±á‡∞®‡±Å ‡∞Æ‡∞ø‡∞§‡±ç‡∞∞‡∞æ, ‡∞Æ‡±Ä ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø ‡∞∏‡∞π‡∞æ‡∞Ø‡∞ï‡±Å‡∞°‡∞ø‡∞®‡∞ø‡•§ ‡∞à‡∞∞‡±ã‡∞ú‡±Å ‡∞®‡±á‡∞®‡±Å ‡∞Æ‡±Ä‡∞ï‡±Å ‡∞é‡∞≤‡∞æ ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ö‡±á‡∞Ø‡∞ó‡∞≤‡∞®‡±Å?",
                    creator: "‡∞®‡±á‡∞®‡±Å AI&ML ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞ü‡±Ä‡∞Æ‡±ç ‡∞ï‡±ã‡∞°‡±ç‚Äå‡∞∏‡±ç‡∞ü‡±ç‡∞∞‡∞æ‡∞Æ‡±ç ‡∞ö‡±á‡∞§ ‡∞∞‡±à‡∞§‡±Å‡∞≤‡∞ï‡±Å ‡∞Ö‡∞™‡±ç‚Äå‡∞ó‡±ç‡∞∞‡±á‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Æ‡∞¶‡±ç‡∞¶‡∞§‡±Å ‡∞á‡∞µ‡±ç‡∞µ‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞§‡∞Ø‡∞æ‡∞∞‡±Å ‡∞ö‡±á‡∞Ø‡∞¨‡∞°‡±ç‡∞°‡∞æ‡∞®‡±Å.",
                    crop: `‡∞Æ‡±Ä ‡∞™‡±ç‡∞∞‡∞æ‡∞Ç‡∞§‡∞Ç ‡∞Ø‡±ä‡∞ï‡±ç‡∞ï ‡∞Æ‡∞ü‡±ç‡∞ü‡∞ø ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£ ‡∞™‡∞∞‡∞ø‡∞∏‡±ç‡∞•‡∞ø‡∞§‡±Å‡∞≤ ‡∞Ü‡∞ß‡∞æ‡∞∞‡∞Ç‡∞ó‡∞æ (${weatherData ? weatherData.name : '‡∞Æ‡±Ä ‡∞™‡±ç‡∞∞‡∞æ‡∞Ç‡∞§‡∞Ç'}), ‡∞à ‡∞∏‡±Ä‡∞ú‡∞®‡±ç‚Äå‡∞≤‡±ã ‡∞ü‡±ä‡∞Æ‡∞æ‡∞ü‡±ã‡∞≤‡±Å ‡∞®‡∞æ‡∞ü‡∞æ‡∞≤‡∞®‡∞ø ‡∞∏‡∞ø‡∞´‡∞æ‡∞∞‡±ç‡∞∏‡±Å ‡∞ö‡±á‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞®‡±Å‡•§`,
                    disease: "‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡±Ä ‡∞Æ‡±ä‡∞ï‡±ç‡∞ï ‡∞Ø‡±ä‡∞ï‡±ç‡∞ï ‡∞´‡±ã‡∞ü‡±ã‡∞®‡±Å ‡∞Ö‡∞™‡±ç‚Äå‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø, ‡∞®‡±á‡∞®‡±Å ‡∞µ‡±ç‡∞Ø‡∞æ‡∞ß‡±Å‡∞≤ ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞Ç‡∞™‡±Å‡∞≤‡±ã ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ö‡±á‡∞∏‡±ç‡∞§‡∞æ‡∞®‡±Å‡•§",
                    weather: `${weatherData ? weatherData.name : '‡∞Æ‡±Ä ‡∞™‡±ç‡∞∞‡∞æ‡∞Ç‡∞§‡∞Ç'}‡∞≤‡±ã ‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§ ‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£‡∞Ç: ${weatherData ? weatherData.main.temp + '¬∞C, ' + weatherData.weather[0].description : '28¬∞C, ‡∞™‡∞æ‡∞ï‡±ç‡∞∑‡∞ø‡∞ï‡∞Ç‡∞ó‡∞æ ‡∞Æ‡±á‡∞ò‡∞æ‡∞µ‡±É‡∞§‡∞Ç'}‡•§`,
                    market: `‡∞Æ‡±Ä ‡∞™‡±ç‡∞∞‡∞æ‡∞Ç‡∞§‡∞Ç‡∞≤‡±ã ‡∞™‡±ç‡∞∞‡∞∏‡±ç‡∞§‡±Å‡∞§ ‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç ‡∞ß‡∞∞‡∞≤‡±Å: ‡∞ü‡±ä‡∞Æ‡∞æ‡∞ü‡±ã ‚Çπ${generateLocationBasedPrices().tomato}/‡∞ï‡∞ø‡∞≤‡±ã‡•§`,
                    default: "‡∞Æ‡±Ä‡∞∞‡±Å ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø‡∞Ç ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø ‡∞Ö‡∞°‡±Å‡∞ó‡±Å‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞∞‡∞®‡∞ø ‡∞®‡±á‡∞®‡±Å ‡∞Ö‡∞∞‡±ç‡∞•‡∞Ç ‡∞ö‡±á‡∞∏‡±Å‡∞ï‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞®‡±Å‡•§ ‡∞Æ‡±Ä ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç ‡∞Ü‡∞ß‡∞æ‡∞∞‡∞Ç‡∞ó‡∞æ ‡∞®‡±á‡∞®‡±Å ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ö‡±á‡∞Ø‡∞ó‡∞≤‡∞®‡±Å‡•§"
                }
            };
            const lang = responses[currentLanguage] || responses.en;
            const lowerInput = input.toLowerCase();
            if (lowerInput.includes('who made you') || lowerInput.includes('creator') || lowerInput.includes('who created you') || lowerInput.includes('‡§ï‡§ø‡§∏‡§®‡•á ‡§¨‡§®‡§æ‡§Ø‡§æ') || lowerInput.includes('‡∞®‡∞ø‡∞®‡±ç‡∞®‡±Å ‡∞é‡∞µ‡∞∞‡±Å ‡∞§‡∞Ø‡∞æ‡∞∞‡±Å ‡∞ö‡±á‡∞∂‡∞æ‡∞∞‡±Å')) {
                return lang.creator;
            } else if (lowerInput.includes('hello') || lowerInput.includes('hi') || lowerInput.includes('‡§®‡§Æ‡§∏‡•ç‡§§‡•á') || lowerInput.includes('‡∞®‡∞Æ‡∞∏‡±ç‡∞ï‡∞æ‡∞∞‡∞Ç')) {
                return lang.greeting;
            } else if (lowerInput.includes('crop') || lowerInput.includes('‡§´‡§∏‡§≤') || lowerInput.includes('‡∞™‡∞Ç‡∞ü')) {
                return lang.crop;
            } else if (lowerInput.includes('disease') || lowerInput.includes('‡§¨‡•Ä‡§Æ‡§æ‡§∞‡•Ä') || lowerInput.includes('‡∞µ‡±ç‡∞Ø‡∞æ‡∞ß‡∞ø')) {
                return lang.disease;
            } else if (lowerInput.includes('weather') || lowerInput.includes('‡§Æ‡•å‡§∏‡§Æ') || lowerInput.includes('‡∞µ‡∞æ‡∞§‡∞æ‡∞µ‡∞∞‡∞£‡∞Ç')) {
                return lang.weather;
            } else if (lowerInput.includes('price') || lowerInput.includes('market') || lowerInput.includes('‡§≠‡§æ‡§µ') || lowerInput.includes('‡∞ß‡∞∞')) {
                return lang.market;
            } else {
                return lang.default;
            }
        }
        function speakText(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = getLanguageCode(currentLanguage);
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }
        function addChatMessage(message, type) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = message;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        function showSection(sectionName, event) {
            // Hide all sections
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => section.classList.add('hidden'));
           
            // Show selected section
            const targetSection = document.getElementById(sectionName);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }
            // Update navigation
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => item.classList.remove('active'));
            event.target.closest('.nav-item')?.classList.add('active');
        }
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Simulate disease detection
                    // In real app, integrate ML model e.g., using TensorFlow.js
                    // Example: load model and predict
                    // const model = await tf.loadLayersModel('path/to/model');
                    // const prediction = model.predict(tensor);
                    setTimeout(() => {
                        const diseaseResults = document.getElementById('diseaseResults');
                        const messagesDiv = document.getElementById('diseaseMessages');
                       
                        diseaseResults.style.display = 'block';
                       
                        const analysisMessage = document.createElement('div');
                        analysisMessage.className = 'message ai';
                        analysisMessage.innerHTML = `
                            <strong>üîç Analysis Complete</strong><br>
                            <strong>Disease Detected:</strong> Early Blight<br>
                            <strong>Confidence:</strong> 87%<br>
                            <strong>Treatment:</strong> Apply Neem oil spray every 3 days<br>
                            <strong>Prevention:</strong> Ensure proper plant spacing and avoid overhead watering<br>
                            <strong>Weather Advisory:</strong> Avoid spraying before rain (expected tomorrow)
                        `;
                        messagesDiv.appendChild(analysisMessage);
                    }, 2000);
                };
                reader.readAsDataURL(file);
            }
        }
        function loadWeatherForecast() {
            const forecast = document.getElementById('weatherForecast');
           
            if (!weatherData) {
                forecast.innerHTML = '<div style="padding: 20px; text-align: center;">Loading weather forecast...</div>';
                return;
            }
            const days = ['Today', 'Tomorrow', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'];
            const baseTemp = weatherData.main.temp;
            const temps = days.map((_, index) => {
                const variation = (Math.random() - 0.5) * 6; // ¬±3¬∞C variation
                return `${Math.round(baseTemp + variation)}¬∞C`;
            });
           
            const conditions = ['Partly Cloudy', 'Rain Expected', 'Sunny', 'Cloudy', 'Hot', 'Cool', 'Pleasant'];
            const icons = ['‚õÖ', 'üåßÔ∏è', '‚òÄÔ∏è', '‚òÅÔ∏è', 'üå°Ô∏è', 'üå§Ô∏è', 'üåû'];
           
            let forecastHTML = '';
            days.forEach((day, index) => {
                const isRainDay = conditions[index].includes('Rain');
                const alertStyle = isRainDay ? 'border-left-color: #FF9800; background: #FFF8E1;' : '';
               
                forecastHTML += `
                    <div style="background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 4px solid #4CAF50; display: flex; justify-content: space-between; align-items: center; ${alertStyle}">
                        <div>
                            <strong>${day}</strong><br>
                            <span style="color: #666;">${conditions[index]}</span>
                            ${isRainDay ? '<br><small style="color: #FF9800;">‚ö†Ô∏è Avoid pesticide spraying</small>' : ''}
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 24px;">${icons[index]}</div>
                            <div style="font-size: 18px; font-weight: bold; color: #4CAF50;">${temps[index]}</div>
                        </div>
                    </div>
                `;
            });
           
            if (userLocation) {
                forecastHTML = `<div style="background: #E8F5E8; padding: 10px; border-radius: 8px; margin-bottom: 15px; text-align: center;">
                    <small>üìç Weather forecast for your location</small>
                </div>` + forecastHTML;
            }
           
            forecast.innerHTML = forecastHTML;
        }
        function loadMarketDetails() {
            const marketDetails = document.getElementById('marketDetails');
           
            // Base crop data
            const crops = [
                { name: 'Tomato', basePrice: 25, unit: 'kg', market: 'Local Mandi' },
                { name: 'Onion', basePrice: 18, unit: 'kg', market: 'Regional Market' },
                { name: 'Wheat', basePrice: 2100, unit: 'qtl', market: 'APMC' },
                { name: 'Rice', basePrice: 3200, unit: 'qtl', market: 'FCI Center' },
                { name: 'Cotton', basePrice: 6800, unit: 'qtl', market: 'Cotton Market' },
                { name: 'Sugarcane', basePrice: 350, unit: 'qtl', market: 'Sugar Mill' }
            ];
            let marketHTML = '';
           
            if (userLocation) {
                marketHTML += `<div style="background: #E8F5E8; padding: 10px; border-radius: 8px; margin-bottom: 15px; text-align: center;">
                    <small>üìç Market prices for your region</small>
                </div>`;
            }
           
            crops.forEach(crop => {
                // Apply location-based price variation
                const locationFactor = 0.85 + Math.random() * 0.3; // 15% variation
                const currentPrice = Math.round(crop.basePrice * locationFactor);
                const trend = Math.random() > 0.5 ? 'up' : 'down';
                const trendPercent = Math.round(Math.random() * 10);
                const trendIcon = trend === 'up' ? '‚ÜóÔ∏è' : '‚ÜòÔ∏è';
                const trendColor = trend === 'up' ? '#4CAF50' : '#F44336';
               
                marketHTML += `
                    <div style="background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; border-left: 4px solid #FF9800;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <strong style="color: #2E7D32;">${crop.name}</strong>
                            <span style="font-size: 18px; font-weight: bold; color: #FF9800;">‚Çπ${currentPrice}/${crop.unit}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: #666;">
                            <span>${crop.market}</span>
                            <span style="color: ${trendColor}">${trendIcon} ${trendPercent}%</span>
                        </div>
                        ${Math.random() > 0.7 ? `<div style="font-size: 11px; color: #FF9800; margin-top: 5px;">üí° Good time to ${trend === 'up' ? 'sell' : 'buy'}</div>` : ''}
                    </div>
                `;
            });
           
            marketDetails.innerHTML = marketHTML;
        }
        function startVoiceChat() {
            startListening();
        }
        // Event listeners
        document.getElementById('languageSelect').addEventListener('change', updateLanguage);
        document.getElementById('voiceButton').addEventListener('click', startListening);
        document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);
        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
        // Add some sample chat messages on initialization
        setTimeout(() => {
            addChatMessage("Welcome to Mitra AI! I'm here to help with all your farming needs. You can ask me about crops, diseases, weather, or market prices.", 'ai');
        }, 1000);
        // TODO: Add push notifications for weather alerts (use Notification API)
        // if ('Notification' in window) {
        //     Notification.requestPermission().then(permission => {
        //         if (permission === 'granted') {
        //             // Send notifications based on weather data
        //         }
        //     });
        // }
        // TODO: Implement offline support with Service Workers
        // if ('serviceWorker' in navigator) {
        //     navigator.serviceWorker.register('/sw.js');
        // }
        // TODO: Expand languages - add more to translations object
        // TODO: User authentication - integrate with Firebase or similar for profiles
    </script>
</body>
</html>
